<script>


$(function () {

  // Set up date field with jquery-ui's datepicker:
  $("#date").datepicker({
    changeMonth: true,
    changeYear: true
  });

  $("#transaction_entity_id").blur(function (event) {
    var id = event.target.value;
    var name = $("#entities option[value="+id+"]").text();
    $("#_transaction_entity_id").text(name);
  });

});

</script>

<%= form_for :transaction, url: "/transactions" do |f| %>

 <fieldset>

  <legend>new transaction</legend>

  <label>date</label>
  <%= f.text_field :date, :id => "date" %><br />

  <label>other party to transaction</label>
  <%= f.text_field :entity_id, :list => "entities", :style => "width: 3em" %>
  <datalist id="entities">
   <% @entities.each do |entity| %>
    <%= content_tag "option", entity.name, value: entity.id, :style => "width: 30em" %>
   <% end %>
  </datalist>
  <span id="_transaction_entity_id"></span>

 </fieldset>

 <fieldset id="entries">
  <table>
   <thead>
    <tr>
     <th>
      item
     </th>
     <th>
      qty
     </th>
     <th>
      @
     </th>
     <th>
      account
     </th>
     <th>
      debit
     </th>
     <th>
      credit
     </th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <td>
      <input name="entry_1[item_id]" list="items" />
     </td>
     <datalist id="items">
      <% @items.each do |item| %>
       item_summary = "#{item.brand} #{item.gendesc}, #{item.qty} #{item.units} (#{item.barcode})"
       <%= content_tag "option", item_summary, value: item.id %>
      <% end %>
     </datalist>
     <td>
      <input name="entry_1[qty]" />
     </td>
     <td>
      <input name="entry_1[price]" />
     </td>
     <td>
      <input name="entry_1[account_id]" list="accounts" />
     </td>
     <datalist id="items">
      <% @accounts.each do |account|  %>
       <%= content_tag "option", account.account_pathname, value: account.id  %>
      <% end %>
     </datalist>
     <td>
      <input id="debit" />
     </td>
     <td>
      <input id="credit" />
     </td>
    </tr>
   </tbody>
  </table>
 </fieldset>

<% end %>

<%= link_to 'Back', transactions_path %>
