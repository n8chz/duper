<script>


$(function () {

  // Set up date field with jquery-ui's datepicker:
  $("#date").datepicker({
    changeMonth: true,
    changeYear: true
  });



});

</script>

<%= form_for :transaction, url: "/transactions" do |f| %>

 <fieldset>

  <legend>new transaction</legend>

  <label>date</label>
  <%= f.text_field :date, :id => "date" %><br />

  <label>other party to transaction</label>
  <%= f.text_field :entity_id, :list => "entities", :style => "width: 3em" %>
  <datalist id="entities">
   <% @entities.each do |entity| %>
    <%= content_tag "option", entity.name, value: entity.id, :style => "width: 30em" %>
   <% end %>
  </datalist>
  <span id="_transaction_entity_id"></span>

 </fieldset>

 <fieldset id="entries">
  <table>
   <thead>
    <tr>
     <th>
      item
     </th>
     <th>
      qty
     </th>
     <th>
      @
     </th>
     <th>
      account
     </th>
     <th>
      debit
     </th>
     <th>
      credit
     </th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <script>
      // see http://jqueryui.com/autocomplete/#custom-data 
      // see http://jqueryui.com/autocomplete/#remote-with-cache 
      // see http://stackoverflow.com/a/3222639/948073

      $(function () {

        var cache = {};

	var items = [
	 <% @items.each do |item| %>
	  <% units = @units.select {|unit| item.unit_id == unit.id} %>
	  <% unit = units.length > 0 ? units[0].unit : "" %>
	  <% item_summary = "#{item.brand} #{item.gendesc}, #{item.size} #{unit} (#{item.barcode})" %>
           {
            value: "<%= item.id %>",
            label: "<%= item_summary %>"
           },
	 <% end %>
           {
            value: "-1",
            label: "create new" 
           }
	 
	];


	$("#items").autocomplete({
          // source: items,
          source: "<%= items_path(:json) %>",
          select: function (event, ui) {
           $("#items").val(ui.item.label);
           $("#items-id").val(ui.item.value);
           return false;
          }
        });

      });

     </script>
     <td>
     <input id="items" />
     <input id="items-id" name="entry_1[item_id]" type="hidden" />
     </td>
     <td>
      <input name="entry_1[qty]" />
     </td>
     <td>
      <input name="entry_1[price]" />
     </td>
     <td>
      <input name="entry_1[account_id]" list="accounts" />
     </td>
     <datalist id="accounts">
      <% @accounts.each do |account|  %>
       <%= content_tag "option", account.account_pathname, value: account.id  %>
      <% end %>
     </datalist>
     <td>
      <input id="debit" />
     </td>
     <td>
      <input id="credit" />
     </td>
    </tr>
   </tbody>
  </table>
 </fieldset>

<% end %>

<%= link_to 'Back', transactions_path %>

